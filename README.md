## ADL 2025 Final Project

## Method

For this jailbreak project, we proposed a black-box model-based attack method to solve the problem. We define the reward of each prompt to be (SR*UR) and we use the pre-trained model to randomly generate rewritten prompts to discover the reward of these prompts. Then we use the rewarded prompts to build a dataset and fine-tune the model with it. After recursively sampling new data from the current model and fine-tuning the model, we can get a suitable prompt rewriting model and a dataset for us to transfer the rewriting ability to other models.

## About '''run.sh'''

The required models and datasets will be downloaded after executing this script, including 2 LoRA models and many datasets.

## About the model and the dataset

The following setting is used to fine-tune the downloaded models.

'''
python3 qlora.py --model_name google/flan-t5-xl --dataset_path data/paired_responses_merged.jsonl --output_dir models/lora_merged_xl --lora_r 256 --lora_alpha 512
python3 qlora.py --model_name google/flan-t5-large --dataset_path data/paired_responses_merged.jsonl --output_dir models/lora_merged
'''

'''scored_responses_1.jsonl''' is generated by the following method.

'''
python3 build_scored_dataset.py --output_scored data/scored_responses_1.jsonl
'''

Before fine-tuning, use '''build_pair.py''' to generate preference pairs with the sampled data.

'''
python3 build_pair.py --input data/scored_responses_1.jsonl --output data/paired_responses_1.jsonl
'''

'''
python3 qlora.py --model_name google/flan-t5-large --dataset_path data/paired_responses_1.jsonl --output_dir models/lora_1
'''

Then use '''lora_1''' to build another dataset with '''build_scored_dataset.py''' by adding '''--lora_path models/lora_1'''

The file '''scored_responses_merged.jsonl''' is merged from all the other included scored responses.

## About the result

Modify MODEL_PATH and LORA_PATH to use different model to generate the results. 

'''results/rewritten_prompts_ADL_Final_25W_part{1, 2}_with_cost_1''' is generated by '''google/flan-t5-xl''' and '''lora_merged_xl'''

'''results/rewritten_prompts_ADL_Final_25W_part{1, 2}_with_cost_2''' is generated by '''google/flan-t5-large''' and '''lora_merged'''

## Reference

All the code is created with the help of Gemini 3 Pro.

Project Slide: https://docs.google.com/presentation/d/1uTDCia4BDQ0mgUUxQjFnAa1SHLRMU9ldY7fCCU4_sCs/edit?slide=id.g3a831f5cc6b_2_0#slide=id.g3a831f5cc6b_2_0

Project Github: https://github.com/yenshan0530/2025-ADL-Final-Challenge-Release